#* @vtlvariable name="userInfoList" type="java.util.List<app.model.UserInfo>" *#
#* @vtlvariable name="exerciseInfoList" type="java.util.List<app.model.ExerciseInfo>" *#
#parse("/velocity/layout.vm")
#@mainLayout()
<div id="students-vue" v-cloak>
    <ul>
        <li @click="getGraph('ALL')">All students</li>
        <li @click="getGraph(student.userId)" v-for="student in students">{{student.userId}}</li>
    </ul>
</div>
<script>
    // client tells the server that it wants to GET "/api/students"
    axios.get("/api/students").then(function (response) {
        new Vue({
            el: '#students-vue',
            data: {students: response.data},
            methods: {
                getGraph: function (userId) {
                    getDataAndDrawGraph(userId);
                }
            }
        })
    });
</script>
<script>

    getDataAndDrawGraph("ALL");

    function getDataAndDrawGraph(userId) {
        var path = userId === "ALL" ? "/api/statistics/exercises" : "/api/statistics/students/" + userId;
        axios.get(path).then(function (response) {
            var graphData = [];
            graphData.push(["Exercise", "Total Attempts"]);
            response.data.forEach(function (element) {
                graphData.push([element.exerciseId, element.totalAttempts]);
            });
            google.charts.load('current', {packages: ['corechart', 'bar']});
            google.charts.setOnLoadCallback(() => drawChart(graphData));
        });
    }

    function drawChart(graphData) {
        var data = google.visualization.arrayToDataTable(graphData);
        var options = {
            title: "Number of attempts per exercise",
            width: 600,
            height: 400,
            bar: {groupWidth: '95%'},
            legend: {position: 'none'},
        };
        var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
        chart.draw(data, options);
    }

</script>
<!--Div that will hold the pie chart-->
<div id="chart_div"></div>
#end
